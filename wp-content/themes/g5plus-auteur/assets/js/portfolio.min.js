var G5_Portfolio=window.G5_Portfolio||{};!function(n){"use strict";window.G5_Portfolio=G5_Portfolio,n(window);var o=n("body"),a=o.hasClass("gf-lazy-load"),e=o.hasClass("rtl");G5_Portfolio={ajax_call:!1,cache:{group:"portfolio_gallery"},init:function(){this.light_box_gallery();var i=n(".gallery-layout-thumbnail");i.length&&this.single_portfolio_gallery(i),this.initJustifiedLayout(),this.updateAjaxSuccess()},get_gallery_cache_key:function(i){return"portfolio_gallery_"+i},light_box_gallery:function(){var l=this;n(document).on("click","[data-portfolio-gallery]",function(i){var t,a,e,o;i.preventDefault(),!1===l.ajax_call&&(t=n(this),a=t.closest(".portfolio-item-inner").addClass("active"),e=parseInt(t.data("id"),10),o=l.get_gallery_cache_key(e),t.append('<i class="fal fa-spinner fa-spin"></i>'),""!==(i=G5_Core.cache.getCache(o,l.cache.group))?(l.show_popup_gallery(i),t.html(""),l.ajax_call=!1,setTimeout(function(){a.removeClass("active")},200)):l.ajax_call=n.ajax({url:g5plus_variable.ajax_url,data:{action:"portfolio_gallery",id:e},success:function(i){l.ajax_call=!1,t.html(""),i.success&&(G5_Core.cache.addCache(o,i.data,l.cache.group),l.show_popup_gallery(i.data),setTimeout(function(){a.removeClass("active")},200))},error:function(i){console.log(i),setTimeout(function(){a.removeClass("active")},200)}}))})},show_popup_gallery:function(i){var t="video"===i.type?"iframe":"image";n.magnificPopup.open({type:t,mainClass:"mfp-zoom-in",midClick:!0,removalDelay:500,items:i.items,gallery:{enabled:!0},callbacks:{beforeOpen:function(){switch(this.st.type){case"image":this.st.image.markup=this.st.image.markup.replace("mfp-figure","mfp-figure mfp-with-anim");break;case"iframe":this.st.iframe.markup=this.st.iframe.markup.replace("mfp-iframe-scaler","mfp-iframe-scaler mfp-with-anim")}},change:function(){var i=this;this.isOpen&&(this.wrap.removeClass("mfp-ready"),setTimeout(function(){i.wrap.addClass("mfp-ready")},10))}}})},single_portfolio_gallery:function(i){var t=i.find(".single-portfolio-gallery-main"),o=i.find(".single-portfolio-gallery-thumb");t.owlCarousel({items:1,nav:!1,dots:!1,loop:!1,rtl:e,lazyLoad:a}).on("changed.owl.carousel",function(i){var t=i.item.index;o.find(".owl-item").removeClass("current").eq(t).addClass("current");var a=o.find(".owl-item.active").length-1,e=o.find(".owl-item.active").first().index(),i=o.find(".owl-item.active").last().index();i<t&&o.data("owl.carousel").to(t,100,!0);t<e&&o.data("owl.carousel").to(t-a,100,!0)}),o.on("initialized.owl.carousel",function(i){o.find(".owl-item").eq(0).addClass("current")}).owlCarousel({items:4,nav:!1,dots:!1,rtl:e,lazyLoad:a,margin:10,responsive:{992:{items:4},768:{items:3},0:{items:2}}}),o.on("click",".owl-item",function(i){i.preventDefault(),n(this).hasClass("current")||(i=n(this).index(),t.data("owl.carousel").to(i,300,!0))}),n(document).on("reset_data",function(i){t.data("owl.carousel").to(0,300,!0)})},initJustifiedLayout:function(i){void 0===i&&(i=n("body")),n(".layout-justified",i).each(function(){var i=n(this),t=i.data("justified-options"),a=t.row_height,e=t.row_max_height,o=t.margin;i.hasClass("justified-init")||i.imagesLoaded({background:!0},function(){i.justifiedGallery({rowHeight:a,maxRowHeight:e,waitThumbnailsLoad:!1,selector:"article.portfolio-grid",margins:o,lastRow:"justify",cssAnimation:!0}).on("jg.complete",function(){i.addClass("justified-init"),n("article.portfolio-grid",i).each(function(){var i="",i=0===n(".entry-thumbnail-overlay",n(this)).length?n(".portfolio-item-inner",n(this)):n(".entry-thumbnail-overlay",n(this)),t=n(this).height();i.css("height",t+"px")})}).on("jg.resize",function(){n("article.portfolio-grid",i).each(function(){var i="",i=0===n(".entry-thumbnail-overlay",n(this)).length?n(".portfolio-item-inner",n(this)):n(".entry-thumbnail-overlay",n(this)),t=n(this).height();i.css("height",t+"px")})})})})},updateAjaxSuccess:function(){o.on("gf_pagination_ajax_success",function(i,t,a,e){"portfolio"===t.settings.post_type&&(n(i.target).imagesLoaded({background:!0},function(){n(".layout-justified",o).each(function(){n(this).removeClass("justified-init")}),setTimeout(function(){G5_Portfolio.initJustifiedLayout()},500)}),G5_Core.pagination_ajax.updatePageTitle(t,a,e),G5_Core.pagination_ajax.updateSideBar(t,a,e))})}},n(document).ready(function(){G5_Portfolio.init()})}(jQuery);